# Example of the GKE template usage.
#
# This config creates a 3 node GKE regional cluster in the following zones.
# - us-east1-b 
# - us-east1-c
# - us-east1-d
# - nodePool maangement is enabled (autoRepair, autoUpgrade) 

imports:
  - path: templates/gke/gke.py
    name: gke.py
  - path: templates/network/network.py
    name: network.py

resources:
  - name: myk8snw
    type: network.py
    properties:
      autoCreateSubnetworks: false
      subnetworks:
        - name: myk8s-subnet
          region: us-east1
          ipCidrRange: 10.0.0.0/24
          privateIpGoogleAccess: false
          enableFlowLogs: true
  - name: myk8sregional
    type: gke.py
    properties:
      clusterLocationType: Regional
      region: us-east1
      cluster:
        name: myk8sregional
        description: my k8s regional cluster
        network: $(ref.myk8snw.networkUrl)
        subnetwork: $(ref.myk8s-subnet.name)
        locations:
          - us-east1-b
          - us-east1-c
          - us-east1-d
        nodePools:
          - name: myk8sregionalpool
            initialNodeCount: 1
            version: 1.11.2-gke.9
            config:
              oauthScopes:
                - https://www.googleapis.com/auth/compute
                - https://www.googleapis.com/auth/devstorage.read_only
                - https://www.googleapis.com/auth/logging.write
                - https://www.googleapis.com/auth/monitoring
            management:
              autoUpgrade: true
              autoRepair: true

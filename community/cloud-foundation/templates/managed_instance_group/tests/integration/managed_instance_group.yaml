# Test of the Managed Instance Group template.
#
# Variables:
#   RAND: a random string used by the testing suite
#   IMAGE: a URL to the base disk image provided by the testing suite

imports:
  - path: templates/instance_template/instance_template.py
    name: instance_template.py
  - path: templates/managed_instance_group/managed_instance_group.py
    name: managed_instance_group.py

resources:
  - name: managed_instance_group-${RAND}
    type: managed_instance_group.py
    properties:
      baseInstanceName: group-base-name-${RAND}
      name: mig-${RAND}
      targetSize: 3
      instanceTemplate: $(ref.instance-template-${RAND}.selfLink)
      zone: us-east1-b
  - name: instance-template-${RAND}
    type: instance_template.py
    properties:
      name: it-${RAND}
      instanceDescription: Instance description
      templateDescription: Template description
      network: $(ref.test-network-${RAND}.selfLink)
      diskImage: ${IMAGE}
      machineType: f1-micro
      canIpForward: true
      diskType: pd-ssd
      diskSizeGb: 50
      tags:
        items:
          - ftp
          - https
      metadata:
        items:
          - key: createdBy
            value: unitTest
      labels:
        name: wrench
  - name: test-network-${RAND}
    type: compute.v1.network
    properties:
      autoCreateSubnetworks: true
